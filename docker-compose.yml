# Execute command -> docker-compose up -d
# Parameters needed here are in ".env" file (needs to be in the same directory!)

version: "3"

services:
  db:
    image: mysql:5.7
    volumes:
      - dbdata:/var/lib/mysql
    ports:
      # - ${MYSQL_PORT}:${CONTAINER_MYSQL_PORT}
      - 3307:3306
    environment:
      #   MYSQL_DATABASE: ${MYSQL_DATABASE}
      MYSQL_USER: "${MYSQL_USER}"
      MYSQL_PASSWORD: "${MYSQL_PASSWORD}"
      MYSQL_DATABASE: "${MYSQL_DATABASE}"
      MYSQL_ROOT_PASSWORD: "${MYSQL_ROOT_PASSWORD}"
    restart: always
    networks:
      - engenharia-app-network

  api:
    depends_on:
      - db
    image: engenharia-api
    restart: always
    build:
      context: ./api
    ports:
      # - ${API_PORT}:${DOCKER_API_PORT}
      - 20000:80
    environment:
      # MYSQL_URL: "${MYSQL_URL}"
      MYSQL_URL: db
      MYSQL_PORT: "${CONTAINER_MYSQL_PORT}"
      MYSQL_DATABASE: "${MYSQL_DATABASE}"
      MYSQL_USER: "${MYSQL_USER}"
      MYSQL_PASSWORD: "${MYSQL_PASSWORD}"
      JWT_SECRET: "${JWT_SECRET}"
    networks:
      - engenharia-app-network

  spa:
    depends_on:
      - api
    image: engenharia-spa
    build:
      context: ./spa
    ports:
      # - ${SPA_PORT}:80
      - 20001:80
    environment:
      API_URL: "${API_URL}:80/api"
    networks:
      - engenharia-app-network

networks:
  engenharia-app-network:
    driver: bridge

volumes:
  dbdata:
